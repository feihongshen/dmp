<?xml version="1.0" encoding="UTF-8"?>
<beans:beans xmlns="http://www.springframework.org/schema/security"
	xmlns:beans="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
        http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security-3.1.xsd">
	<!-- HTTP security configurations auto-config="true" -->
	<http use-expressions="true" auto-config="false" entry-point-ref="http403EntryPoint">
		<!-- <form-login login-processing-url="/resources/j_spring_security_check" 
			login-page="/login" authentication-failure-url="/login?login_error=t" authentication-success-handler-ref="authenticationSuccessHandler" 
			/> <form-login login-processing-url="/resources/j_pda_check" default-target-url="/cwborderPDA?requestpara=userlogin" 
			authentication-failure-url="/cwborderPDA/loginError" authentication-success-handler-ref="authenticationSuccessHandler" 
			/> -->
		<!-- <session-management invalid-session-url="/login?login_error=s" session-authentication-strategy-ref=""> 
			<concurrency-control max-sessions="1" /> </session-management> -->
		<logout logout-url="/resources/j_spring_security_logout" />
		<!-- Configure these elements to secure URIs in your application -->
		<intercept-url pattern="/choices/**" access="hasRole('ROLE_ADMIN')" />
		<intercept-url pattern="/member/**" access="isAuthenticated()" />
		<intercept-url pattern="/resources/**" access="permitAll" />
		<intercept-url pattern="/images/**" access="permitAll" />
		<intercept-url pattern="/uppda/**" access="permitAll" />
		<intercept-url pattern="/css/**" access="permitAll" />
		<intercept-url pattern="/dmp40/**" access="permitAll" />
		<intercept-url pattern="/login" access="permitAll" />
		<intercept-url pattern="/slogin" access="permitAll" />
		<intercept-url pattern="/image" access="permitAll" />
		<intercept-url pattern="/imageForOutside" access="permitAll" />
		<intercept-url pattern="/js/**" access="permitAll" />
		<intercept-url pattern="/cwborderPDA/loginError" access="permitAll" />
		<intercept-url pattern="/cwborderPDA/" access="permitAll" />
		<intercept-url pattern="/cwborderPDA/newPDA" access="permitAll" />
		<intercept-url pattern="/cwborderPDA/loadWavFile"
			access="permitAll" />
		<intercept-url pattern="/cwborderPDA/getSystime" access="permitAll" />
		<intercept-url pattern="/order/orderFlowQueryByCwb/**"
			access="permitAll" />
		<intercept-url pattern="/order/orderFlowQueryForOutsideByCwb/**"
			access="permitAll" />
		<intercept-url pattern="/order/wumaorderFlowQueryForOutsideByCwb/**"
			access="permitAll" />
		<intercept-url pattern="/order/norderFlowQueryForOutsideByCwb/**"
			access="permitAll" />
			<intercept-url pattern="/order/queryOrderFlowByCwb/**"
			access="permitAll" />
		<intercept-url pattern="/wavPlay**" access="permitAll" />


		<intercept-url pattern="/setdefaultexport/**" access="permitAll" />
		<intercept-url pattern="/setexportcwb/**" access="permitAll" />
		<intercept-url pattern="/OMSInterface/**" access="permitAll" />
		<intercept-url pattern="/EPMInterface/**" access="permitAll" />
		<intercept-url pattern="/address/**" access="permitAll" />

		<!--20120817 POS对接管理 -->
		<intercept-url pattern="/alipay/**" access="permitAll" />
		<intercept-url pattern="/yeepay/**" access="permitAll" />
		<intercept-url pattern="/bill99/**" access="permitAll" />
		<intercept-url pattern="/alipayinter_test/**" access="permitAll" />
		<intercept-url pattern="/bill99inter_test/**" access="permitAll" />
		<intercept-url pattern="/unionpay/**" access="permitAll" />
		<intercept-url pattern="/chinaums/**" access="permitAll" />
		<intercept-url pattern="/alipaycodapp/**" access="permitAll" />
		<intercept-url pattern="/chinaums_test/**" access="permitAll" />
		<intercept-url pattern="/mobiledcb/**" access="permitAll" />
		<intercept-url pattern="/tlmpos/**" access="permitAll" />

		<!-- 20121031 b2c对接管理 -->
		<intercept-url pattern="/tmall/**" access="permitAll" />
		<intercept-url pattern="/tmalltest/**" access="permitAll" />
		<intercept-url pattern="/vipshop/**" access="permitAll" />
		<intercept-url pattern="/yihaodian/**" access="permitAll" />
		<intercept-url pattern="/explinkInterface/**" access="permitAll" />
		<intercept-url pattern="/jumeiyoupin/**" access="permitAll" />
		<intercept-url pattern="/lefeng/**" access="permitAll" />
		<intercept-url pattern="/rufengda/**" access="permitAll" />
		<intercept-url pattern="/yixun/**" access="permitAll" />
		<intercept-url pattern="/jingdong/**" access="permitAll" />
		<intercept-url pattern="/jdCwbTrack/track**" access="permitAll" />
		<intercept-url pattern="/gome/**" access="permitAll" />
		<intercept-url pattern="/dangdangdatasyn/**" access="permitAll" />
		<intercept-url pattern="/dangdangdatasyntest/**" access="permitAll" />
		<intercept-url pattern="/explinkdatasyn/**" access="permitAll" />
		<intercept-url pattern="/gzabc/**" access="permitAll" />
		<intercept-url pattern="/abctest/**" access="permitAll" />
		<intercept-url pattern="/hzabc/**" access="permitAll" />
		<intercept-url pattern="/amazon/**" access="permitAll" />
		<intercept-url pattern="/dongfangcj/**" access="permitAll" />
		<intercept-url pattern="/httx/**" access="permitAll" />
		<intercept-url pattern="/maikaolin/**" access="permitAll" />
		<intercept-url pattern="/S_huobang/**" access="permitAll" />
		<intercept-url pattern="/telecom/**" access="permitAll" />

		<intercept-url pattern="/Yalian_go/**" access="permitAll" />

		<intercept-url pattern="/benlaishenghuo/**" access="permitAll" />

		<intercept-url pattern="/etong/**" access="permitAll" />
		<intercept-url pattern="/epaiApi/**" access="permitAll" />
		<intercept-url pattern="/epaicore/**" access="permitAll" />
		<intercept-url pattern="/jointManage/**" access="permitAll" />
		<intercept-url pattern="/happyGo/**" access="permitAll" />
		<intercept-url pattern="/maisike/**" access="permitAll" />
		<intercept-url pattern="/jobHand/**" access="permitAll" />
		<intercept-url pattern="/smile/**" access="permitAll" />
		<intercept-url pattern="/yhdAddressmatch/**" access="permitAll" />
		<intercept-url pattern="/liantong/**" access="permitAll" />

		<intercept-url pattern="/httxAddress/**" access="permitAll" />

		<intercept-url pattern="/alipayapp/**" access="permitAll" />
		<intercept-url pattern="/hxgdms/**" access="permitAll" />
		<intercept-url pattern="/wangjiu/**" access="permitAll" />
		<intercept-url pattern="/homegobj/**" access="permitAll" />
		<intercept-url pattern="/lechong/**" access="permitAll" />
		<intercept-url pattern="/service/**" access="permitAll" />
		<intercept-url pattern="/zhongliang/**" access="permitAll" />
        <intercept-url pattern="/mss/**" access="permitAll" />
		<intercept-url pattern="/expressSysMonitor/**" access="permitAll" />
		<intercept-url pattern="/checkbranch/**" access="permitAll" />
		<intercept-url pattern="/location/**" access="permitAll" />
		<intercept-url pattern="/GoodsStatusNum/**" access="permitAll" />
		<intercept-url pattern="/workorder/**" access="permitAll" />
		<intercept-url pattern="/customerContract/**" access="permitAll" />
		<intercept-url pattern="/SettlementContract/**" access="permitAll" />
		<intercept-url pattern="/CustomerBillContract/**" access="permitAll" />
		<intercept-url pattern="/branchContract/**" access="permitAll" />
		<intercept-url pattern="/gztl/**" access="permitAll" />
		<intercept-url pattern="/cacheSynchro/**" access="permitAll" />

		<intercept-url pattern="/jiuye/**" access="permitAll" />
		<intercept-url pattern="/feiniuwang/**" access="permitAll" />
		<intercept-url pattern="/huanqiugou/**" access="permitAll" />
		
 		<intercept-url pattern="/jiuyeaddressmatch/**" access="permitAll" />
 		<intercept-url pattern="/yonghui/**" access="permitAll" />
 		<intercept-url pattern="/feiniuwang/**" access="permitAll" />
		<intercept-url pattern="/huanqiugou/**" access="permitAll" />
 		
 		<intercept-url pattern="/deliverServer/**" access="permitAll" />
 		<intercept-url pattern="/bjunion/**" access="permitAll" />
 		<intercept-url pattern="/suning/**" access="permitAll" />
 		<intercept-url pattern="/pinhaohuo/**" access="permitAll" />
 		
 		<intercept-url pattern="/gxdxAddress/**" access="permitAll" />
 		
 		<intercept-url pattern="/javax.comm.jar" access="permitAll" />
		<intercept-url pattern="/ScaleApplet.jar" access="permitAll" />
		<intercept-url pattern="/ScaleApplet.cert" access="permitAll" />
		<intercept-url pattern="/ScaleApplet.store" access="permitAll" />
		<!-- EMS对接 -->
		<intercept-url pattern="/ems/transcwbFlow/**" access="permitAll" />
				
		<intercept-url pattern="/health_check.jsp" access="permitAll" />
				
		<intercept-url pattern="/**" access="isAuthenticated()" />
		<custom-filter position="CONCURRENT_SESSION_FILTER" ref="concurrentSessionFilter" />
		<custom-filter before="FORM_LOGIN_FILTER" ref="loginFilter" />
		<custom-filter position="FORM_LOGIN_FILTER" ref="PDALoginFilter" />

		<!-- <custom-filter before="LOGOUT_FILTER" ref="logoutFilter" /> <custom-filter 
			position="LOGOUT_FILTER" ref="adminLogoutFilter" /> -->

		<session-management
			session-authentication-strategy-ref="sas" />

	</http>


	<beans:bean id="sas"
		class="org.springframework.security.web.authentication.session.ConcurrentSessionControlStrategy">
		<beans:constructor-arg name="sessionRegistry"
			ref="sessionRegistry" />
		<beans:property name="maximumSessions" value="1" />
		<!-- 防止session攻击 -->
		<beans:property name="alwaysCreateSession" value="true" />
		<beans:property name="migrateSessionAttributes" value="false" />
		<!-- 同一个帐号 同时只能一个人登录 -->
		<beans:property name="exceptionIfMaximumExceeded"
			value="false" />
	</beans:bean>

	<beans:bean id="sessionRegistry"
		class="org.springframework.security.core.session.SessionRegistryImpl" />

	<!-- Configure Authentication mechanism -->
	<authentication-manager alias="authenticationManager">
		<!-- SHA-256 values can be produced using 'echo -n your_desired_password 
			| sha256sum' (using normal *nix environments) -->
		<authentication-provider user-service-ref="userdetailservice">
			<password-encoder hash="plaintext" />
		</authentication-provider>
	</authentication-manager>

	<beans:bean name="md5PasswordEncoder"
		class="org.springframework.security.authentication.encoding.Md5PasswordEncoder">
	</beans:bean>



	<beans:bean id="userdetailservice" class="cn.explink.service.UserDetailService">
	</beans:bean>

	<!-- <beans:bean id="authenticationSuccessHandler" class="cn.explink.jms.ExplinkAuthenticationSuccessHandler"></beans:bean> -->

	<beans:bean
		class="org.springframework.security.core.context.SecurityContextHolder"
		factory-method="getContextHolderStrategy" />
		
	<beans:bean id="concurrentSessionFilter"  
	    class="org.springframework.security.web.session.ConcurrentSessionFilter">  
	    <beans:property name="sessionRegistry" ref="sessionRegistry" />  
	    <beans:property name="expiredUrl" value="/login?login_error=s" />  
	    <beans:property name="logoutHandlers">  
	        <beans:array>  
	            <beans:bean id="logoutHandler"  
			        class="org.springframework.security.web.authentication.logout.SecurityContextLogoutHandler">  
			    </beans:bean>
	        </beans:array>  
	    </beans:property>  
	</beans:bean>

	<beans:bean id="loginFilter"
		class="org.springframework.security.web.authentication.ValidateCodeAuthenticationFilter">
		<beans:property name="postOnly" value="false"></beans:property>
		<beans:property name="authenticationManager" ref="authenticationManager" />
		<beans:property name="authenticationFailureHandler"
			ref="failureHandler" />
		<beans:property name="authenticationSuccessHandler"
			ref="successHandler" />
		<beans:property name="filterProcessesUrl"
			value="/resources/j_spring_security_check" />
		<beans:property name="sessionAuthenticationStrategy"
			ref="sas" />
	</beans:bean>
	<beans:bean id="failureHandler"
		class="org.springframework.security.web.authentication.SimpleUrlAuthenticationFailureHandler">
		<!-- 资金归集修改，https方式登录时，如出错需重新跳回slogin页面 -->
		<!--<beans:property name="defaultFailureUrl" value="/login?login_error=t" />-->
		<beans:property name="defaultFailureUrl" value="/slogin?login_error=t" />
	</beans:bean>
	<beans:bean id="successHandler"
		class="cn.explink.jms.ExplinkAuthenticationSuccessHandler">
		<beans:property name="alwaysUseDefaultTargetUrl" value="true" />
		<beans:property name="defaultTargetUrl" value="/" />
	</beans:bean>

	<beans:bean id="PDALoginFilter"
		class="org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter">
		<beans:property name="authenticationManager" ref="authenticationManager" />
		<beans:property name="authenticationFailureHandler"
			ref="PDAFailureHandler" />
		<beans:property name="authenticationSuccessHandler"
			ref="PDASuccessHandler" />
		<beans:property name="filterProcessesUrl" value="/resources/j_pda_check" />
		<beans:property name="sessionAuthenticationStrategy"
			ref="sas" />
	</beans:bean>
	<beans:bean id="PDAFailureHandler"
		class="org.springframework.security.web.authentication.SimpleUrlAuthenticationFailureHandler">
		<beans:property name="defaultFailureUrl" value="/cwborderPDA/loginError" />
	</beans:bean>
	<beans:bean id="PDASuccessHandler"
		class="cn.explink.jms.ExplinkAuthenticationSuccessHandler">
		<beans:property name="alwaysUseDefaultTargetUrl" value="true" />
		<beans:property name="defaultTargetUrl" value="/cwborderPDA/login" />
	</beans:bean>

	<beans:bean id="http403EntryPoint"
		class="org.springframework.security.web.authentication.Http403ForbiddenEntryPoint">
	</beans:bean>

</beans:beans>